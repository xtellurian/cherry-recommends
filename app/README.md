# The Signal Box App

## Application Model

The important applications models are:

* Tracked User: Represents a user in external systems
* Tracked User Event: Event data generated by those users, e.g. bought something, logged in, etc.
* Offer: Something that may be shown to a tracked user, and may or may not be accepted.
* Segment: A collection of tracked users that share some common attribute or behaviour.
* Experiment: A long running process, whereby a set of offers are shown to many users.
* Presenter: Responsible for choosing which offers to show to a tracked user within the context of an experiment.

## Multitenants

Multitenanting can be  achieved via 
* subdomains, i.e. {tenant}.ourdomain.com or {tenant}.local.zone:5001
* paths (frontend only)
* header (x-tenant)
* query string


### Local Dev Subdomains

To run locally, you need to setup the DNS routing properly.

One solution (on Mac) is to run dnsmasq

```
brew install dnsmasq
```

Configure dnsmasq by adding this to the configuration file: `$(brew --prefix)/etc/dnsmasq.conf.`

```
address=/local.zone/127.0.0.1
```

and start dnsmasq like so:

```
sudo brew services start dnsmasq
```

THEN, create a DNS resolver by pttubg the following in file /etc/resolver/local.zone

```
nameserver 127.0.0.1
```

like so: `sudo bash -c 'echo "nameserver 127.0.0.1" > /etc/resolver/local.zone'`
Gist that helps:

https://gist.github.com/ogrrd/5831371

---

## Networking in Production

In production, stacks are placed into subdomains (e.g. canary.cherry.ai)
The scripts in `deploy/azure-scripts/dns-cherry.ai` update the DNS Zone accordingly.

> The DNS Zone is in a protected subscription.

## SSL Certificates

We use Azure App Service Certificates as a provider for SSL certificates.
The scripts in `deploy/azure-scripts/dns-cherry.ai` should configure the verification.
The final linking of certificates should be done in the Azure Portal.

## Development

The development dependencies can be run from the `/develop` directory.

* Azure Storage (docker azurite)
* SQL Server (docker sql server)

## Tests

### Dotnet tests

```
dotnet test
```

### Frontend (React JS) tests

```
cd web/ClientApp
npm test
```
