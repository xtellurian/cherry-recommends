{
  "name": "Pipeline 1",
  "type": "Microsoft.Synapse/workspaces/pipelines",
  "properties": {
    "activities": [
      {
        "additionalProperties": null,
        "dataset": {
          "parameters": {
            "tenants_db": {
              "type": "Expression",
              "value": "@pipeline().parameters.tenant_db"
            }
          },
          "referenceName": "tenants_lookup",
          "type": "DatasetReference"
        },
        "dependsOn": [],
        "description": "",
        "firstRowOnly": null,
        "linkedServiceName": null,
        "name": "Tenant Lookup",
        "policy": {
          "additionalProperties": null,
          "retry": 0,
          "retryIntervalInSeconds": 30,
          "secureInput": false,
          "secureOutput": false,
          "timeout": "7.00:00:00"
        },
        "source": {
          "additionalColumns": null,
          "additionalProperties": null,
          "maxConcurrentConnections": null,
          "partitionOption": "None",
          "partitionSettings": null,
          "produceAdditionalTypes": null,
          "queryTimeout": "02:00:00",
          "sourceRetryCount": null,
          "sourceRetryWait": null,
          "sqlReaderQuery": {
            "type": "Expression",
            "value": "@concat(\u0027SELECT DatabaseName FROM dbo.Tenants WHERE Name = \u0027\u0027\u0027,pipeline().parameters.tenant_name, \u0027\u0027\u0027\u0027)"
          },
          "sqlReaderStoredProcedureName": null,
          "storedProcedureParameters": null,
          "type": "AzureSqlSource"
        },
        "type": "Lookup",
        "userProperties": []
      },
      {
        "additionalProperties": null,
        "dataIntegrationUnits": null,
        "dependsOn": [
          {
            "activity": "Tenant Lookup",
            "additionalProperties": null,
            "dependencyConditions": ["Succeeded"]
          }
        ],
        "description": null,
        "enableSkipIncompatibleRow": null,
        "enableStaging": false,
        "inputs": [
          {
            "parameters": {
              "tenant_name": {
                "type": "Expression",
                "value": "@activity(\u0027Tenant Lookup\u0027).output.firstRow.DatabaseName"
              }
            },
            "referenceName": "tenant_data",
            "type": "DatasetReference"
          }
        ],
        "linkedServiceName": null,
        "logSettings": null,
        "logStorageSettings": null,
        "name": "Copy Tenant Data",
        "outputs": [
          {
            "parameters": {},
            "referenceName": "tenant_adls_data",
            "type": "DatasetReference"
          }
        ],
        "parallelCopies": null,
        "policy": {
          "additionalProperties": null,
          "retry": 0,
          "retryIntervalInSeconds": 30,
          "secureInput": false,
          "secureOutput": false,
          "timeout": "7.00:00:00"
        },
        "preserve": null,
        "preserveRules": null,
        "redirectIncompatibleRowSettings": null,
        "sink": {
          "additionalProperties": null,
          "formatSettings": {
            "additionalProperties": null,
            "fileExtension": ".txt",
            "fileNamePrefix": null,
            "maxRowsPerFile": null,
            "quoteAllText": true,
            "type": "DelimitedTextWriteSettings"
          },
          "maxConcurrentConnections": null,
          "sinkRetryCount": null,
          "sinkRetryWait": null,
          "storeSettings": {
            "additionalProperties": null,
            "blockSizeInMB": 4,
            "copyBehavior": null,
            "maxConcurrentConnections": null,
            "type": "AzureBlobFSWriteSettings"
          },
          "type": "DelimitedTextSink",
          "writeBatchSize": null,
          "writeBatchTimeout": null
        },
        "skipErrorFile": null,
        "source": {
          "additionalColumns": null,
          "additionalProperties": null,
          "maxConcurrentConnections": null,
          "partitionOption": "None",
          "partitionSettings": null,
          "produceAdditionalTypes": null,
          "queryTimeout": "02:00:00",
          "sourceRetryCount": null,
          "sourceRetryWait": null,
          "sqlReaderQuery": "SELECT TOP (1000) * FROM [dbo].[__EFMigrationsHistory]",
          "sqlReaderStoredProcedureName": null,
          "storedProcedureParameters": null,
          "type": "AzureSqlSource"
        },
        "stagingSettings": null,
        "translator": {
          "type": "TabularTranslator",
          "typeConversion": true,
          "typeConversionSettings": {
            "allowDataTruncation": true,
            "treatBooleanAsNumber": false
          }
        },
        "type": "Copy",
        "userProperties": [],
        "validateDataConsistency": null
      }
    ],
    "parameters": {
      "tenant_db": {
        "defaultValue": "tenants",
        "type": "string"
      },
      "tenant_name": {
        "defaultValue": null,
        "type": "string"
      }
    }
  }
}
